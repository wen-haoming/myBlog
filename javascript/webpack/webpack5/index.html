<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <link rel="stylesheet" href="/umi.css" />
    <script>
      window.routerBase = "/";
    </script>
    <script>
      //! umi version: 3.3.7
    </script>
    <title>webpack5</title>
  </head>
  <body>
    <div id="root"><div class="__dumi-default-layout" data-route="/javascript/webpack/webpack5" data-show-sidemenu="true" data-show-slugs="false" data-site-mode="true" data-gapless="false"><div class="__dumi-default-navbar" data-mode="site"><button class="__dumi-default-navbar-toggle"></button><a class="__dumi-default-navbar-logo" href="/">Ming仔</a><nav><div class="__dumi-default-search"><input type="search" class="__dumi-default-search-input" value=""/><ul></ul></div><span>前端<ul><li><a href="/javascript/base">基础</a></li><li><a href="/javascript/business">业务</a></li><li><a href="/javascript/api">浏览器API</a></li><li><a href="/javascript/react">react</a></li><li><a href="/javascript/vue">vue</a></li><li><a aria-current="page" class="active" href="/javascript/webpack">webpack</a></li><li><a href="/javascript/project">项目实践</a></li></ul></span><span>python<ul><li><a href="/python/base">python语言学习</a></li><li><a href="/python/base2">python程序进阶</a></li><li><a href="/python/neuralnetwork">神经网络基础</a></li><li><a href="/python/tensoflow">Tensoflow</a></li></ul></span><span>书籍</span><span>计算机相关<ul><li><a href="/cs/base">基础</a></li></ul></span><span>杂七杂八<ul><li><a href="/order/efficiency">工作效率</a></li><li><a href="/order/think">个人思考</a></li></ul></span></nav></div><div class="__dumi-default-menu" data-mode="site"><div class="__dumi-default-menu-inner"><div class="__dumi-default-menu-header"><a class="__dumi-default-menu-logo" href="/"></a><h1>Ming仔</h1><p></p></div><div class="__dumi-default-menu-mobile-area"><ul class="__dumi-default-menu-nav-list"><li>前端<ul><li><a href="/javascript/base">基础</a></li><li><a href="/javascript/business">业务</a></li><li><a href="/javascript/api">浏览器API</a></li><li><a href="/javascript/react">react</a></li><li><a href="/javascript/vue">vue</a></li><li><a aria-current="page" class="active" href="/javascript/webpack">webpack</a></li><li><a href="/javascript/project">项目实践</a></li></ul></li><li>python<ul><li><a href="/python/base">python语言学习</a></li><li><a href="/python/base2">python程序进阶</a></li><li><a href="/python/neuralnetwork">神经网络基础</a></li><li><a href="/python/tensoflow">Tensoflow</a></li></ul></li><li>书籍</li><li>计算机相关<ul><li><a href="/cs/base">基础</a></li></ul></li><li>杂七杂八<ul><li><a href="/order/efficiency">工作效率</a></li><li><a href="/order/think">个人思考</a></li></ul></li></ul></div><ul class="__dumi-default-menu-list"><li><a href="/javascript/webpack/base">webpack4基础以及优化方案</a></li><li><a href="/javascript/webpack/principle">webpack 原理</a><ul><li><a href="/javascript/webpack/principle"><span>principle</span></a></li></ul></li><li><a href="/javascript/webpack/sourcemap">sourcemap</a></li><li><a href="/javascript/webpack/chunk">hash</a></li><li><a href="/javascript/webpack/module-federation">moduleFederation</a></li><li><a aria-current="page" class="active" href="/javascript/webpack/webpack5">webpack5</a><ul role="slug-list"><li title="启动命令" data-depth="2"><a href="/javascript/webpack/webpack5#启动命令"><span>启动命令</span></a></li><li title="持久化缓存" data-depth="2"><a href="/javascript/webpack/webpack5#持久化缓存"><span>持久化缓存</span></a></li><li title="资源模块" data-depth="2"><a href="/javascript/webpack/webpack5#资源模块"><span>资源模块</span></a></li><li title="URLs" data-depth="2"><a href="/javascript/webpack/webpack5#urls"><span>URLs</span></a></li><li title="长期缓存" data-depth="2"><a href="/javascript/webpack/webpack5#长期缓存"><span>长期缓存</span></a></li><li title="移除 Nodejs 的 polyfill" data-depth="2"><a href="/javascript/webpack/webpack5#移除-nodejs-的-polyfill"><span>移除 Nodejs 的 polyfill</span></a></li><li title="更好的 treeShaking 优化" data-depth="2"><a href="/javascript/webpack/webpack5#更好的-treeshaking-优化"><span>更好的 treeShaking 优化</span></a></li><li title="sideEffect" data-depth="2"><a href="/javascript/webpack/webpack5#sideeffect"><span>sideEffect</span></a></li><li title="模块联邦" data-depth="2"><a href="/javascript/webpack/webpack5#模块联邦"><span>模块联邦</span></a></li></ul></li></ul></div></div><div class="__dumi-default-layout-content"><div class="markdown"><h1 id="webpack5"><a aria-hidden="true" tabindex="-1" href="/javascript/webpack/webpack5#webpack5"><span class="icon,icon-link"></span></a>webpack5</h1><blockquote><p>本文从最简单的角度去提取有关的更新内容，更详细都需要去查看<a target="_blank" rel="noopener noreferrer" href="https://webpack.docschina.org/concepts/">官方文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote><ul><li>启动命令</li><li>长期缓存</li><li>资源模块</li><li>modulelds &amp; chunklds 的优化</li><li>更智能的 tree shaking</li><li>nodejs 的 polufill 脚本被移除</li><li>模块联邦</li></ul><h2 id="启动命令"><a aria-hidden="true" tabindex="-1" href="/javascript/webpack/webpack5#启动命令"><span class="icon,icon-link"></span></a>启动命令</h2><p>从 <code>webpack 5</code> 开始，启动 dev-server 命令就开始使用 <code>webpack serve</code> ,</p><h2 id="持久化缓存"><a aria-hidden="true" tabindex="-1" href="/javascript/webpack/webpack5#持久化缓存"><span class="icon,icon-link"></span></a>持久化缓存</h2><p><a target="_blank" rel="noopener noreferrer" href="https://webpack.docschina.org/blog/2020-10-10-webpack-5-release/#major-changes-performance">官方文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p><p>如果 <code>cache.type : &quot;filesystem&quot;</code> 时，可以配合以下选项进行配合，但是 <code>cache.type : &quot;memory&quot;</code> 的时候，就不能使用以下选项。</p><ul><li>cache.cacheDirectory</li><li>cache.name</li><li>cache.version</li><li>cache.store</li><li>cache.hashAlgorithm</li><li>cache.idleTimeout</li><li>cache.idleTimeoutForIntialStore</li><li>cache.buildDependencies</li></ul><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">module</span><span class="token punctuation">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  cache</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// 1. 将缓存类型设置为文件系统</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    type</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;filesystem&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">    buildDependencies</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token comment">// 2. 将你的 config 添加为 buildDependency，以便在改变 config 时获得缓存无效</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      config</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain">__filename</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token comment">// 3. 如果你有其他的东西被构建依赖，你可以在这里添加它们</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token comment">// 注意，webpack、加载器和所有从你的配置中引用的模块都会被自动添加</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h2 id="资源模块"><a aria-hidden="true" tabindex="-1" href="/javascript/webpack/webpack5#资源模块"><span class="icon,icon-link"></span></a>资源模块</h2><p><a target="_blank" rel="noopener noreferrer" href="https://webpack.docschina.org/guides/asset-modules/">官方文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p><p>在 webpack 5 之前，通常使用：</p><ul><li><code>raw-loader</code> 将文件导入为字符串</li><li><code>url-loader</code> 将文件作为 data URI 内联到 bundle 中</li><li><code>file-loader</code> 将文件发送到输出目录</li></ul><p>资源模块类型(asset module type)，通过添加 4 种新的模块类型，来替换所有这些 loader：</p><ul><li>asset/resource 发送一个单独的文件并导出 URL。之前通过使用 file-loader 实现。</li><li>asset/inline 导出一个资源的 data URI。之前通过使用 url-loader 实现。</li><li>asset/source 导出资源的源代码。之前通过使用 raw-loader 实现。</li><li>asset 在导出一个 data URI 和发送一个单独的文件之间自动选择。之前通过使用 url-loader，并且配置资源体积限制实现。</li></ul><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain"> module</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        rules</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            test</span><span class="token punctuation">:</span><span class="token regex">/\.js$/</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            use</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">                loader</span><span class="token punctuation">:</span><span class="token string">&#x27;babel-loader&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">                options</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">                    presets</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">&#x27;@babel/preset-env&#x27;</span><span class="token punctuation">,</span><span class="token string">&#x27;@babel/preset-react&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">                    exclude</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token plain">node_modules</span><span class="token operator">/</span><span class="token plain">  </span><span class="token comment">// 不打包 不变异node_modules下面的包</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">                </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            </span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            test</span><span class="token punctuation">:</span><span class="token regex">/\.png$/</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            type</span><span class="token punctuation">:</span><span class="token string">&#x27;asset/resource&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token comment">//对标 file-loader</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            test</span><span class="token punctuation">:</span><span class="token regex">/\.ico$/</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            type</span><span class="token punctuation">:</span><span class="token string">&#x27;asset/inline&#x27;</span><span class="token plain"> </span><span class="token comment">// 对标 url-loader 模块大小 limut base64 字符串</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token plain"> </span></div><div class="token-line"><span class="token plain">            test</span><span class="token punctuation">:</span><span class="token regex">/\.txt$/</span><span class="token punctuation">,</span><span class="token plain"> </span></div><div class="token-line"><span class="token plain">            type</span><span class="token punctuation">:</span><span class="token string">&#x27;asset/source&#x27;</span><span class="token plain"> </span><span class="token comment">// 对标raw-loader</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            test</span><span class="token punctuation">:</span><span class="token regex">/.jpg$/</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            type</span><span class="token punctuation">:</span><span class="token string">&#x27;asset&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token comment">//对标raw-loader</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            parser</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">                dataUrlCondition</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">                    maxSize</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token operator">*</span><span class="token number">1024</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">                </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">]</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h2 id="urls"><a aria-hidden="true" tabindex="-1" href="/javascript/webpack/webpack5#urls"><span class="icon,icon-link"></span></a>URLs</h2><p>webpack5 支持在请求中处理协议</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword module">import</span><span class="token plain"> data </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&#x27;data:text/javascript,export default &quot;title&quot;&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token plain">data</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h2 id="长期缓存"><a aria-hidden="true" tabindex="-1" href="/javascript/webpack/webpack5#长期缓存"><span class="icon,icon-link"></span></a>长期缓存</h2><p><a target="_blank" rel="noopener noreferrer" href="https://www.cnblogs.com/giggle/p/9583940.html">文件指纹相关<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>新增了长期缓存的算法。这些算法在生产模式下是默认启用的。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">optimization</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    chunkIds</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&quot;deterministic&quot;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    moduleIds</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&quot;deterministic&quot;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    mangleExports</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&quot;deterministic&quot;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">  entry</span><span class="token punctuation">:</span><span class="token string">&#x27;./src/index.js&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">     output</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        filename</span><span class="token punctuation">:</span><span class="token string">&#x27;[chunkhash:8].js&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        chunkFilename</span><span class="token punctuation">:</span><span class="token string">&#x27;[chunkhash:8]-chunk.js&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    mode</span><span class="token punctuation">:</span><span class="token string">&#x27;development&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    devtool</span><span class="token punctuation">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    devServer</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        port</span><span class="token punctuation">:</span><span class="token number">8080</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    cache</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        type</span><span class="token punctuation">:</span><span class="token string">&#x27;filesystem&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        cacheDirectory</span><span class="token punctuation">:</span><span class="token plain"> path</span><span class="token punctuation">.</span><span class="token method function property-access">resolve</span><span class="token punctuation">(</span><span class="token plain">__dirname</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&#x27;./cache/webpack&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    optimization</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        moduleIds</span><span class="token punctuation">:</span><span class="token string">&#x27;natural&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token comment">// 自然数自增</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        chunkIds</span><span class="token punctuation">:</span><span class="token string">&#x27;natural&#x27;</span><span class="token comment">// 自然数自增</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>但是上面的配置有个问题，如果其中一个包重新打包的话，另外的包的 id 也会随之改变，尽管我没有改过，不过这个问题可以在webpack5中得以解决。</p><div class="__dumi-default-code-block"><pre class="prism-code language-diff"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token unchanged"> // 能够保证生成当前模块的id不变</span></div><div class="token-line"><span class="token unchanged"> optimization:{</span></div><div class="token-line"><span class="token unchanged"></span><span class="token inserted-sign inserted">+        moduleIds:&#x27;deterministic&#x27;, </span></div><div class="token-line"><span class="token inserted-sign inserted">+        chunkIds:&#x27;deterministic&#x27;</span></div><div class="token-line"><span class="token inserted-sign inserted"></span><span class="token unchanged">    }</span></div><div class="token-line"><span class="token unchanged"></span></div></pre></div><h2 id="移除-nodejs-的-polyfill"><a aria-hidden="true" tabindex="-1" href="/javascript/webpack/webpack5#移除-nodejs-的-polyfill"><span class="icon,icon-link"></span></a>移除 Nodejs 的 polyfill</h2><p><a target="_blank" rel="noopener noreferrer" href="https://webpack.docschina.org/blog/2020-10-10-webpack-5-release/#automatic-nodejs-polyfills-removed">官方文档更新内容<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p><ul><li>webpack4带了许多Node.js核心模块的polyfill,一旦模块中使用了任何核心模块(如crypto)，这些模块就会被自动启用</li><li>webpack5不再自动引入这些polyfill</li></ul><p>例如</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword module">import</span><span class="token plain"> path </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&#x27;path&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token string">&#x27;./a.js&#x27;</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token string">&#x27;./b.js&#x27;</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token string">&#x27;./c.js&#x27;</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token plain">path</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>当我们打包以上代码的时候，webpack4 的策略是把 path 包会打包进去，但是 webpack5 会自动检查 nodejs 的模块，并且需要自己根据提示信息手动进行对应的配置。</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">If you want to include a polyfill, you need to:</span></div><div class="token-line"><span class="token plain">- </span><span class="token function">add</span><span class="token plain"> a fallback </span><span class="token string">&#x27;resolve.fallback: { &quot;path&quot;: require.resolve(&quot;path-browserify&quot;) }&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">- </span><span class="token function">install</span><span class="token plain"> </span><span class="token string">&#x27;path-browserify&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h2 id="更好的-treeshaking-优化"><a aria-hidden="true" tabindex="-1" href="/javascript/webpack/webpack5#更好的-treeshaking-优化"><span class="icon,icon-link"></span></a>更好的 treeShaking 优化</h2><p><a target="_blank" rel="noopener noreferrer" href="https://webpack.docschina.org/blog/2020-10-10-webpack-5-release/#general-tree-shaking-improvements">官方文档更新内容<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><br/></p><p><a target="_blank" rel="noopener noreferrer" href="https://webpack.docschina.org/guides/tree-shaking/">官方文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p><p>export * 已经得到改进，可以跟踪更多的信息，并且不再将默认导出标记为使用。</p><p>export * 现在会在 webpack 确定有冲突的导出时显示警告。</p><p>import() 允许通过 /* webpackExports: [&quot;abc&quot;, &quot;default&quot;] */ 该魔法注释手动 tree shake 模块。</p><p>目录结构</p><div class="__dumi-default-code-block"><pre class="prism-code language-diff"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">webpack-demo</span></div><div class="token-line"><span class="token plain">|- package.json</span></div><div class="token-line"><span class="token plain">|- webpack.config.js</span></div><div class="token-line"><span class="token plain">|- /dist</span></div><div class="token-line"><span class="token plain"></span><span class="token unchanged">  |- bundle.js</span></div><div class="token-line"><span class="token unchanged">  |- index.html</span></div><div class="token-line"><span class="token unchanged"></span><span class="token plain">|- /src</span></div><div class="token-line"><span class="token plain"></span><span class="token inserted-sign inserted">+  |- index.js</span></div><div class="token-line"><span class="token inserted-sign inserted">+  |-module1.js </span></div><div class="token-line"><span class="token inserted-sign inserted">+  |-module2.js</span></div><div class="token-line"><span class="token inserted-sign inserted"></span><span class="token plain">|- /node_modules</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>webpack.config.js</p><div class="__dumi-default-code-block"><pre class="prism-code language-diff"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">module.exports = {</span></div><div class="token-line"><span class="token plain"></span><span class="token inserted-sign inserted">+   mode: &#x27;production&#x27;,</span></div><div class="token-line"><span class="token inserted-sign inserted"></span><span class="token unchanged">    optimization:{</span></div><div class="token-line"><span class="token unchanged"></span><span class="token inserted-sign inserted">+       usedExports:true</span></div><div class="token-line"><span class="token inserted-sign inserted"></span><span class="token unchanged">    }</span></div><div class="token-line"><span class="token unchanged"></span><span class="token plain">}</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment">// src\index.js</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword module">import</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain">function1</span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&#x27;./module1&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token plain">function1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// src\module1.js</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword module">export</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">function1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&#x27;function1&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword module">export</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">function2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&#x27;function2&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">//  src\module2.js </span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword module">export</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">function3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&#x27;function3&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword module">export</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">function4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&#x27;function4&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>这样的话只会打包 <code>index.js</code> 中的 <code>function1</code></p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment">// main.js 最后打包的结果</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token arrow operator">=&gt;</span><span class="token punctuation">{</span><span class="token string">&quot;use strict&quot;</span><span class="token punctuation">;</span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&quot;function1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h2 id="sideeffect"><a aria-hidden="true" tabindex="-1" href="/javascript/webpack/webpack5#sideeffect"><span class="icon,icon-link"></span></a>sideEffect</h2><p><a target="_blank" rel="noopener noreferrer" href="https://webpack.docschina.org/blog/2020-10-10-webpack-5-release/#inner-module-tree-shaking">官方文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p><p>package.json</p><div class="__dumi-default-code-block"><pre class="prism-code language-json"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token property">&quot;slideEffects&quot;</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>但是这样会把 css 的代码都当成副作用给忽略掉，可以这么配置</p><p>package.json</p><div class="__dumi-default-code-block"><pre class="prism-code language-json"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token property">&quot;slideEffects&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&quot;*.css&quot;</span><span class="token punctuation">]</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h2 id="模块联邦"><a aria-hidden="true" tabindex="-1" href="/javascript/webpack/webpack5#模块联邦"><span class="icon,icon-link"></span></a>模块联邦</h2><p><a target="_blank" rel="noopener noreferrer" href="https://webpack.docschina.org/concepts/module-federation/">官方文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p><ol><li>为了不同开发小组间共同开发一个或者多个应用。</li><li>应用将被划分为更小的应用块，一个应用块，可以是比如头部导航或者侧边栏的前端组件，也可以是数据获取逻辑的逻辑组件</li><li>每个应用块由不同的组开发</li><li>应用或应用块共享其他其他应用块或者库</li></ol><blockquote><p>模块联邦可以取代微前端吗？</p></blockquote></div><div class="__dumi-default-layout-footer-meta"><span data-updated-text="最后更新时间：">2/15/2021 11:46:53</span></div></div></div></div>
	<script>
  window.g_useSSR = true;
  window.g_initialProps = {};
	</script>

    <script src="/umi.js"></script>
  </body>
</html>
