<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <link rel="stylesheet" href="/umi.css" />
    <script>
      window.routerBase = "/";
    </script>
    <script>
      //! umi version: 3.3.7
    </script>
    <title>webpack4基础以及优化方案</title>
  </head>
  <body>
    <div id="root"><div class="__dumi-default-layout" data-route="/javascript/webpack/base" data-show-sidemenu="true" data-show-slugs="false" data-site-mode="true" data-gapless="false"><div class="__dumi-default-navbar" data-mode="site"><button class="__dumi-default-navbar-toggle"></button><a class="__dumi-default-navbar-logo" href="/">Ming仔</a><nav><div class="__dumi-default-search"><input type="search" class="__dumi-default-search-input" value=""/><ul></ul></div><span>前端<ul><li><a href="/javascript/base">基础</a></li><li><a href="/javascript/business">业务</a></li><li><a href="/javascript/api">浏览器API</a></li><li><a href="/javascript/react">react</a></li><li><a href="/javascript/vue">vue</a></li><li><a aria-current="page" class="active" href="/javascript/webpack">webpack</a></li><li><a href="/javascript/project">项目实践</a></li></ul></span><span>python<ul><li><a href="/python/base">python语言学习</a></li><li><a href="/python/base2">python程序进阶</a></li><li><a href="/python/neuralnetwork">神经网络基础</a></li><li><a href="/python/tensoflow">Tensoflow</a></li></ul></span><span>书籍</span><span>计算机相关<ul><li><a href="/cs/base">基础</a></li></ul></span><span>杂七杂八<ul><li><a href="/order/efficiency">工作效率</a></li><li><a href="/order/think">个人思考</a></li></ul></span></nav></div><div class="__dumi-default-menu" data-mode="site"><div class="__dumi-default-menu-inner"><div class="__dumi-default-menu-header"><a class="__dumi-default-menu-logo" href="/"></a><h1>Ming仔</h1><p></p></div><div class="__dumi-default-menu-mobile-area"><ul class="__dumi-default-menu-nav-list"><li>前端<ul><li><a href="/javascript/base">基础</a></li><li><a href="/javascript/business">业务</a></li><li><a href="/javascript/api">浏览器API</a></li><li><a href="/javascript/react">react</a></li><li><a href="/javascript/vue">vue</a></li><li><a aria-current="page" class="active" href="/javascript/webpack">webpack</a></li><li><a href="/javascript/project">项目实践</a></li></ul></li><li>python<ul><li><a href="/python/base">python语言学习</a></li><li><a href="/python/base2">python程序进阶</a></li><li><a href="/python/neuralnetwork">神经网络基础</a></li><li><a href="/python/tensoflow">Tensoflow</a></li></ul></li><li>书籍</li><li>计算机相关<ul><li><a href="/cs/base">基础</a></li></ul></li><li>杂七杂八<ul><li><a href="/order/efficiency">工作效率</a></li><li><a href="/order/think">个人思考</a></li></ul></li></ul></div><ul class="__dumi-default-menu-list"><li><a aria-current="page" class="active" href="/javascript/webpack/base">webpack4基础以及优化方案</a><ul role="slug-list"><li title="entry 入口" data-depth="2"><a href="/javascript/webpack/base#entry-入口"><span>entry 入口</span></a></li><li title="output 出口" data-depth="2"><a href="/javascript/webpack/base#output-出口"><span>output 出口</span></a></li><li title="文件指纹" data-depth="2"><a href="/javascript/webpack/base#文件指纹"><span>文件指纹</span></a></li><li title="自动清理构建产物" data-depth="2"><a href="/javascript/webpack/base#自动清理构建产物"><span>自动清理构建产物</span></a></li><li title="css3的前缀增强" data-depth="2"><a href="/javascript/webpack/base#css3的前缀增强"><span>css3的前缀增强</span></a></li><li title="多页面应用打包通用方案" data-depth="2"><a href="/javascript/webpack/base#多页面应用打包通用方案"><span>多页面应用打包通用方案</span></a></li><li title="source map" data-depth="2"><a href="/javascript/webpack/base#source-map"><span>source map</span></a></li><li title="提取公共资源" data-depth="2"><a href="/javascript/webpack/base#提取公共资源"><span>提取公共资源</span></a></li><li title="Scope Hoisting" data-depth="2"><a href="/javascript/webpack/base#scope-hoisting"><span>Scope Hoisting</span></a></li><li title="在 webpack 中使用 eslint" data-depth="2"><a href="/javascript/webpack/base#在-webpack-中使用-eslint"><span>在 webpack 中使用 eslint</span></a></li><li title="webpack 打包组件和打包库" data-depth="2"><a href="/javascript/webpack/base#webpack-打包组件和打包库"><span>webpack 打包组件和打包库</span></a></li><li title="构建配置抽离 npm 包" data-depth="2"><a href="/javascript/webpack/base#构建配置抽离-npm-包"><span>构建配置抽离 npm 包</span></a></li><li title="多进程，多实例构建" data-depth="2"><a href="/javascript/webpack/base#多进程，多实例构建"><span>多进程，多实例构建</span></a></li><li title="多进程多实例：并行压缩" data-depth="2"><a href="/javascript/webpack/base#多进程多实例：并行压缩"><span>多进程多实例：并行压缩</span></a></li><li title="使用缓存来提升二次构建速度" data-depth="2"><a href="/javascript/webpack/base#使用缓存来提升二次构建速度"><span>使用缓存来提升二次构建速度</span></a></li><li title="缩小构建目标" data-depth="2"><a href="/javascript/webpack/base#缩小构建目标"><span>缩小构建目标</span></a></li><li title="使用 Tree Shaking 擦除无用的 js 和 css" data-depth="2"><a href="/javascript/webpack/base#使用-tree-shaking-擦除无用的-js-和-css"><span>使用 Tree Shaking 擦除无用的 js 和 css</span></a></li></ul></li><li><a href="/javascript/webpack/principle">webpack 原理</a><ul><li><a href="/javascript/webpack/principle"><span>principle</span></a></li></ul></li><li><a href="/javascript/webpack/sourcemap">sourcemap</a></li><li><a href="/javascript/webpack/chunk">hash</a></li><li><a href="/javascript/webpack/module-federation">moduleFederation</a></li><li><a href="/javascript/webpack/webpack5">webpack5</a></li></ul></div></div><div class="__dumi-default-layout-content"><div class="markdown"><h1 id="webpack的基础知识和优化"><a aria-hidden="true" tabindex="-1" href="/javascript/webpack/base#webpack的基础知识和优化"><span class="icon,icon-link"></span></a>webpack的基础知识和优化</h1><p>本文提供一系列在工作中较为通用的 webpack 基础和优化策略。</p><ul><li>安装本地的webpack</li><li>webpack webpack-cli -D</li></ul><h1 id="基础"><a aria-hidden="true" tabindex="-1" href="/javascript/webpack/base#基础"><span class="icon,icon-link"></span></a>基础</h1><h2 id="entry-入口"><a aria-hidden="true" tabindex="-1" href="/javascript/webpack/base#entry-入口"><span class="icon,icon-link"></span></a>entry 入口</h2><p><a target="_blank" rel="noopener noreferrer" href="https://webpack.docschina.org/concepts/entry-points/">官方文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p><p>单个入口 entry: string | [string]</p><p>entry 的三种形式：字符串，数组和对象</p><ul><li>字符串 entry</li></ul><p>如果是字符串的话，直接解析该文件依赖，但是filename 这个字段的 <code>[name].js</code> 是无效的。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">module</span><span class="token punctuation">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    mode</span><span class="token punctuation">:</span><span class="token string">&#x27;development&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    entry</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#x27;./src/index.js&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    output</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        path</span><span class="token punctuation">:</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#x27;./dist&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        filename</span><span class="token punctuation">:</span><span class="token string">&#x27;[name].js&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><ul><li>对象 entry</li></ul><p>如果对象只有一个 key 值，那么就直打包一个chunk，如果多个就打包多个，并且 key 是可以以路径的形式存起来，不过记得注意，output 的 filename 记得是 [name].js</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">module</span><span class="token punctuation">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    mode</span><span class="token punctuation">:</span><span class="token string">&#x27;development&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    entry</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token string">&#x27;app-entry&#x27;</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;./app.js&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    output</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        path</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;./output&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        filename</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;[name].js&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><ul><li>数组 entry</li></ul><p>如果 entry 是一个数组，那么会把数组多个包打包成一个 chunk 文件，通常是用于不相依赖的包中使用，而且 filename是 <code>[name].js</code> 无效的。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">module</span><span class="token punctuation">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    mode</span><span class="token punctuation">:</span><span class="token string">&#x27;development&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    entry</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#x27;./src/index1.js&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#x27;./src/index2.js&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    output</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        path</span><span class="token punctuation">:</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#x27;./dist&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        filename</span><span class="token punctuation">:</span><span class="token string">&#x27;[name].js&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h2 id="output-出口"><a aria-hidden="true" tabindex="-1" href="/javascript/webpack/base#output-出口"><span class="icon,icon-link"></span></a>output 出口</h2><p>在 webpack 中的 output 字段包含很多属性，但是我着重讲讲一些常用的 output 的字段属性。</p><ol><li><p>path 必须是一个绝对路径，不能是相对路径</p></li><li><p>publicPath 在加载外部资源的时候，比如（图片，文件）是一个非常重要的选项，大部分情况下是默认为 /</p></li></ol><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> path </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;path&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">  module</span><span class="token punctuation">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">//...</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    output</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> </span></div><div class="token-line"><span class="token plain">      path</span><span class="token punctuation">:</span><span class="token plain"> path</span><span class="token punctuation">.</span><span class="token method function property-access">resolve</span><span class="token punctuation">(</span><span class="token plain">__dirname</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&#x27;public/assets&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      publicPath</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;https://cdn.example.com/assets/&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><ol start="3"><li>library &amp; libraryTarget 配置一个库使用的</li></ol><p>library 暴露到全局的属性名称</p><p>如果没有设置output.library值，那么将不会发生赋值行为。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">module</span><span class="token punctuation">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    mode</span><span class="token punctuation">:</span><span class="token string">&#x27;development&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    entry</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#x27;./src/index.js&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    output</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        path</span><span class="token punctuation">:</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#x27;./dist&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        filename</span><span class="token punctuation">:</span><span class="token string">&#x27;[name].js&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        library</span><span class="token punctuation">:</span><span class="token string">&#x27;mydemp&#x27;</span><span class="token plain"> </span><span class="token comment">// 打包出去就以这个名字暴露到全局上</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>libraryTarget 配合 library 此配置的作用是控制 webpack 打包的内容是如何暴露的，</p><h2 id="文件指纹"><a aria-hidden="true" tabindex="-1" href="/javascript/webpack/base#文件指纹"><span class="icon,icon-link"></span></a>文件指纹</h2><p>详细可以看看我另外一篇<a href="/javascript/webpack/chunk">链接</a></p><p>文件指纹是打包后输出的文件名后缀</p><ul><li>Hash： 和整个项目的构建有关，只要<code>项目文件</code>有修改，整个项目构建的 hash 值就会改变。 （只要有文件变化，就会改变）</li><li>Chunkhash：和 webpack 打包的 <code>chunk</code> 有关，不同的 entry 会生成不同的 chunkhash 值。 （不同的 entry 会生成不同的 chunkhash，对于js的文件指纹，通常是使用这个）</li><li>Contenthash：根据文件内容定义 hash，<code>文件内容</code>不变，则 contenthash 不变。（如果js改变了css不想改变，所以css资源使用这个避免改变hash）</li></ul><p>如何使用?</p><p><code>js</code> 使用 <code>chunkhash</code></p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">  module</span><span class="token punctuation">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  entry</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  app</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;./src/app.js&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  search</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;./src/search.js&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  output</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token operator">+</span><span class="token plain"> filename</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;[name][chunkhash:8].js&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    path</span><span class="token punctuation">:</span><span class="token plain"> __dirname </span><span class="token operator">+</span><span class="token plain"> </span><span class="token string">&#x27;/dist&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p><code>css</code> 使用 <code>Contenthash</code> ：需要另外配备一个 <code>MiniCssExtractPlugin</code> 这个插件，因为我们需要独立的 css 文件来配备其中的文件名。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">module</span><span class="token punctuation">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    entry</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      app</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;./src/app.js&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      search</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;./src/search.js&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        module</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        rules</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">                test</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token regex">/.js$/</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">                use</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;babel-loader&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">                test</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token regex">/.css$/</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">                use</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">                    </span><span class="token maybe-class-name">MiniCssExtractPlugin</span><span class="token punctuation">.</span><span class="token property-access">loader</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">                    </span><span class="token string">&#x27;css-loader&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">                </span><span class="token punctuation">]</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">                test</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token regex">/.less$/</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">                use</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">                    </span><span class="token maybe-class-name">MiniCssExtractPlugin</span><span class="token punctuation">.</span><span class="token property-access">loader</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">                    </span><span class="token string">&#x27;css-loader&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">                    </span><span class="token string">&#x27;less-loader&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">                </span><span class="token punctuation">]</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">]</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">    output</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      filename</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;[name][chunkhash:8].js&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        path</span><span class="token punctuation">:</span><span class="token plain"> __dirname </span><span class="token operator">+</span><span class="token plain"> </span><span class="token string">&#x27;/dist&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      plugins</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token operator">+</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> </span></div><div class="token-line"><span class="token plain">          </span><span class="token operator">+</span><span class="token plain"> filename</span><span class="token punctuation">:</span><span class="token plain"> `</span><span class="token punctuation">[</span><span class="token plain">name</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token plain">contenthash</span><span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token property-access">css</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token operator">+</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">]</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p><code>图片</code> 文件指纹使用<code>hash</code>设置，这个<code>hash</code> 不是指前面 js 的 hash</p><p>其中后缀名称</p><table><thead><tr><th align="left">占位符名称</th><th align="left">含义</th></tr></thead><tbody><tr><td align="left">[ext]</td><td align="left">资源后缀名</td></tr><tr><td align="left">[name]</td><td align="left">文件名称</td></tr><tr><td align="left">[path]</td><td align="left">文件的相对路径</td></tr><tr><td align="left">[folder]</td><td align="left">文件夹所在的文件夹</td></tr><tr><td align="left">[contenthash]</td><td align="left">文件的内容 hash，默认是 md5 生成</td></tr><tr><td align="left">[hash]</td><td align="left">文件内容的 Hash，默认是 md5 生成</td></tr><tr><td align="left">[emoji]</td><td align="left">一个随机的指代文件内容emoj</td></tr></tbody></table><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> path </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;path&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">module</span><span class="token punctuation">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  entry</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;./src/index.js&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  output</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    filename</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;bundle.js&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    path</span><span class="token punctuation">:</span><span class="token plain"> path</span><span class="token punctuation">.</span><span class="token method function property-access">resolve</span><span class="token punctuation">(</span><span class="token plain">__dirname</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&#x27;dist&#x27;</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  module</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  rules</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    test</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token regex">/\.(png|svg|jpg|gif)$/</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    use</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      loader</span><span class="token punctuation">:</span><span class="token plain"> &#x27;file</span><span class="token operator">-</span><span class="token plain">loader’</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token operator">+</span><span class="token plain"> options</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token operator">+</span><span class="token plain"> name</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;img/[name][hash:8].[ext] &#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token operator">+</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"> </span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token plain"> </span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h2 id="自动清理构建产物"><a aria-hidden="true" tabindex="-1" href="/javascript/webpack/base#自动清理构建产物"><span class="icon,icon-link"></span></a>自动清理构建产物</h2><p>每次构建的时候不会清理目录，造成构建的输出目录 output 文件越来越多。</p><p>命令行</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token function">rm</span><span class="token plain"> -rf ./dist </span><span class="token operator">&amp;&amp;</span><span class="token plain"> webpaclk</span></div><div class="token-line"><span class="token plain">rimraf ./dist </span><span class="token operator">&amp;&amp;</span><span class="token plain"> webpack</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token function">npm</span><span class="token plain"> i clean-webpack-plugin -D</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>使用 <code>clean-webpack-plugin</code> 默认会删除 output 指定的输出目录</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">  plugins</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">CleanWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">]</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h2 id="css3的前缀增强"><a aria-hidden="true" tabindex="-1" href="/javascript/webpack/base#css3的前缀增强"><span class="icon,icon-link"></span></a>css3的前缀增强</h2><p>代码层面：</p><ul><li>页面框架的初始化脚本</li><li>上报相关打点</li><li>css内联避免页面闪动</li></ul><p>请求层面：</p><ul><li>小图片或者字体内联（url-loader）</li></ul><p><code>raw-loader</code> 内联 html</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token function">npm</span><span class="token plain"> i raw-loader@0.5.1 -D</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>内联 html</p><div class="__dumi-default-code-block"><pre class="prism-code language-html"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token tag punctuation">&lt;</span><span class="token tag">script</span><span class="token tag punctuation">&gt;</span><span class="token script language-javascript">$</span><span class="token script language-javascript punctuation">{</span><span class="token script language-javascript function">require</span><span class="token script language-javascript punctuation">(</span><span class="token script language-javascript string">&#x27;raw-loader!babel-loader!./meta.html&#x27;</span><span class="token script language-javascript punctuation">)</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation">}</span><span class="token tag punctuation">&lt;/</span><span class="token tag">script</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>内联 js</p><div class="__dumi-default-code-block"><pre class="prism-code language-html"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token tag punctuation">&lt;</span><span class="token tag">script</span><span class="token tag punctuation">&gt;</span><span class="token script language-javascript">$</span><span class="token script language-javascript punctuation">{</span><span class="token script language-javascript function">require</span><span class="token script language-javascript punctuation">(</span><span class="token script language-javascript string">&#x27;raw-loader!babel-loader!../node_modules/lib-flexible&#x27;</span><span class="token script language-javascript punctuation">)</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation">}</span><span class="token tag punctuation">&lt;/</span><span class="token tag">script</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>内联 css</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token function">npm</span><span class="token plain"> i style-loader -D</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">module</span><span class="token punctuation">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    module</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        rules</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          test</span><span class="token punctuation">:</span><span class="token regex">/\.scss$/</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          use</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">              loader</span><span class="token punctuation">:</span><span class="token string">&#x27;style-loader&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">              options</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">                insertAt</span><span class="token punctuation">:</span><span class="token string">&#x27;top&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">                singleton</span><span class="token punctuation">:</span><span class="token boolean">true</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">              </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            </span><span class="token string">&#x27;css-loader&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            </span><span class="token string">&#x27;sass-loader&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token punctuation">]</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h2 id="多页面应用打包通用方案"><a aria-hidden="true" tabindex="-1" href="/javascript/webpack/base#多页面应用打包通用方案"><span class="icon,icon-link"></span></a>多页面应用打包通用方案</h2><p>多页应用好处</p><ul><li>业务解耦</li><li>对 seo 友好</li></ul><p>每个页面对应一个<code>entry</code>，一个 <code>html-webpack-plugin</code></p><p>缺点：每次新增或删除页面需要更改 webpack 配置。</p><p>动态获取 entry 和设置 <code>html-webpack-plugin</code> 数量</p><p>利用 <code>glob.sync</code></p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token function">npm</span><span class="token plain"> i glob -D</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">entry:glob.sync</span><span class="token punctuation">(</span><span class="token plain">path.join</span><span class="token punctuation">(</span><span class="token plain">__dirname,</span><span class="token string">&#x27;./src/*/index.js&#x27;</span><span class="token punctuation">))</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h2 id="source-map"><a aria-hidden="true" tabindex="-1" href="/javascript/webpack/base#source-map"><span class="icon,icon-link"></span></a>source map</h2><p>有关 source map 更详细的内容可以查看<a href="/javascript/webpack/sourcemap">链接</a></p><p>通过 source map 定位到源码</p><p>开发环境开启，线上环境关闭</p><ul><li><p>线上排查问题的时候可以将 sourcemap 上传到错误监控系统。</p></li><li><p>eval：不产生 sourcemap 文件，在包代码中会使用 eval 包裹来指定对应代码。</p></li><li><p>source map：产生 .map 文件</p></li><li><p>cheap：不包含列信息</p></li><li><p>inline：将 map 作为 DataURI 嵌入，不单独生成 .map 文件</p></li><li><p>module：包含 loader sourcemap</p></li></ul><h2 id="提取公共资源"><a aria-hidden="true" tabindex="-1" href="/javascript/webpack/base#提取公共资源"><span class="icon,icon-link"></span></a>提取公共资源</h2><p>利用 <code>splitChunksPlugin</code> 进行公共脚本分离</p><p>chunk 参数说明</p><ul><li>async 异步引入的库进行分离（默认）</li><li>initial 同步引入的库进行分离</li><li>all 所有引入的库进行分离（推荐）</li></ul><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">module</span><span class="token punctuation">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    optimization</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    splitChunks</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      chunks</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;async&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      minSize</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">20000</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      minRemainingSize</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      maxSize</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      minChunks</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      maxAsyncRequests</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">30</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      maxInitialRequests</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">30</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      enforceSizeThreshold</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">50000</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      cacheGroups</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        defaultVendors</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          test</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token regex">/node_modules/</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          priority</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          reuseExistingChunk</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword module">default</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          minChunks</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          priority</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          reuseExistingChunk</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><ol><li>分离基础包</li></ol><p>test:匹配出需要分离的包，提取出来 <code>vendors</code> 需要把这个 chunk 放到 <code>html-webpack-plugin</code> 中的 <code>chunks</code> 中</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">module</span><span class="token punctuation">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    optimization</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      splitChunks</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      cacheGroups</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        commons</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        test</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token regex">/(react|react-dom)/</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        name</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;vendors&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        chunks</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;all&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">}</span><span class="token plain"> </span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"> </span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  plugins</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">htmlwebpackplugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token spread operator">...</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        chunks</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">&#x27;vendors&#x27;</span><span class="token punctuation">]</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><ol start="2"><li>分离页面公共文件</li></ol><p>minChunk：设置最小引用次数 minuSize：分离的包体积的大小</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">module</span><span class="token punctuation">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    optimization</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      splitChunks</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      minSize</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      cacheGroups</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          commons</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          name</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;commons&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          chunks</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;all&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          minChunks</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">2</span><span class="token plain"> </span><span class="token comment">//这个包至少被其他地方引用2次</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token punctuation">}</span><span class="token plain"> </span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">}</span><span class="token plain"> </span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token plain"> </span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h2 id="scope-hoisting"><a aria-hidden="true" tabindex="-1" href="/javascript/webpack/base#scope-hoisting"><span class="icon,icon-link"></span></a>Scope Hoisting</h2><p>随着我们的模块的增多，那么最后打包出来的代码都是闭包包裹，导致体积增大，运行代码时创建的函数作用域变多，内存开销变大。</p><ul><li>被 webpack 转换后的模块会带上一层包裹</li><li>import 会被转义成 _webpack_require</li></ul><p>如果在 mode = production 的时候就会自动开启</p><h2 id="在-webpack-中使用-eslint"><a aria-hidden="true" tabindex="-1" href="/javascript/webpack/base#在-webpack-中使用-eslint"><span class="icon,icon-link"></span></a>在 webpack 中使用 eslint</h2><p><a target="_blank" rel="noopener noreferrer" href="https://github.com/webpack-contrib/eslint-webpack-plugin">用法地址<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token function">npm</span><span class="token plain"> </span><span class="token function">install</span><span class="token plain"> eslint-webpack-plugin --save-dev</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h2 id="webpack-打包组件和打包库"><a aria-hidden="true" tabindex="-1" href="/javascript/webpack/base#webpack-打包组件和打包库"><span class="icon,icon-link"></span></a>webpack 打包组件和打包库</h2><p>webpack 除了可以用来打包应用，也可以用来打包 js 库。</p><p>比如：实现一个大整数加法库的打包。</p><ul><li>需要打包压缩版和非压缩版本</li><li>支持 AMD/CJS/ESM 版本</li></ul><p>支持方式</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment">// es module</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword module">import</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token keyword module">as</span><span class="token plain"> largeNumber </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&#x27;large-number&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// cjs</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">cosnt largeNumbers </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;large-number&#x27;</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// amd</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token function">require</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#x27;large-number&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">large</span><span class="token parameter operator">-</span><span class="token parameter">number</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// script标签引入</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token operator">&lt;</span><span class="token plain">script src</span><span class="token operator">=</span><span class="token string">&quot;xxx&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>如何将库暴露出去？</p><ul><li>library：指定库的全局变量</li><li>libraryTarget：支持库引入的方式</li></ul><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">output</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  filename</span><span class="token punctuation">:</span><span class="token string">&#x27;[name].js&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  library</span><span class="token punctuation">:</span><span class="token string">&#x27;largeNumber&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  libraryExport</span><span class="token punctuation">:</span><span class="token string">&#x27;default&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  libraryTarget</span><span class="token punctuation">:</span><span class="token string">&#x27;umd&#x27;</span><span class="token plain"> </span><span class="token comment">// var, this, global 等等 暴露出去的值的</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h2 id="构建配置抽离-npm-包"><a aria-hidden="true" tabindex="-1" href="/javascript/webpack/base#构建配置抽离-npm-包"><span class="icon,icon-link"></span></a>构建配置抽离 npm 包</h2><p>通用性</p><ul><li>业务开发无需关注构建配置</li><li>统一团队构建脚本</li></ul><p>可维护性</p><ul><li>构建配置合理拆分</li><li>README 文档，ChangeLog 文档等</li></ul><p>质量</p><ul><li>冒烟测试，单元测试，测试覆盖率</li><li>持续集成</li></ul><h2 id="多进程，多实例构建"><a aria-hidden="true" tabindex="-1" href="/javascript/webpack/base#多进程，多实例构建"><span class="icon,icon-link"></span></a>多进程，多实例构建</h2><ul><li>HappyPack (由于后续不维护了，所以替换 thread-loader)</li><li>thread-loader</li><li>parallel-webpack</li></ul><p>(happyPack)[<a target="_blank" rel="noopener noreferrer" href="https://github.com/amireh/happypack#readme">https://github.com/amireh/happypack#readme<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>] (thread-loader)[https://github.com/webpack-contrib/thread-loader]</p><p>happyPack</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> </span><span class="token maybe-class-name">HappyPack</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;happypack&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">exports</span><span class="token punctuation">.</span><span class="token property-access">module</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  rules</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      test</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token regex">/.js$/</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token comment">// 1) replace your original list of loaders with &quot;happypack/loader&quot;:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token comment">// loaders: [ &#x27;babel-loader?presets[]=es2015&#x27; ],</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      use</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;happypack/loader&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      include</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"> </span><span class="token comment">/* ... */</span><span class="token plain"> </span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      exclude</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"> </span><span class="token comment">/* ... */</span><span class="token plain"> </span><span class="token punctuation">]</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">]</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">exports</span><span class="token punctuation">.</span><span class="token property-access">plugins</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// 2) create the plugin:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">HappyPack</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// 3) re-add the loaders you replaced above in #1:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    loaders</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"> </span><span class="token string">&#x27;babel-loader?presets[]=es2015&#x27;</span><span class="token plain"> </span><span class="token punctuation">]</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>thread-loader</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">module</span><span class="token punctuation">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  module</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    rules</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        test</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token regex">/\.js$/</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        include</span><span class="token punctuation">:</span><span class="token plain"> path</span><span class="token punctuation">.</span><span class="token method function property-access">resolve</span><span class="token punctuation">(</span><span class="token string">&#x27;src&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        use</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token string">&#x27;thread-loader&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token comment">// your expensive loader (e.g babel-loader)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h2 id="多进程多实例：并行压缩"><a aria-hidden="true" tabindex="-1" href="/javascript/webpack/base#多进程多实例：并行压缩"><span class="icon,icon-link"></span></a>多进程多实例：并行压缩</h2><p>在代码输出之前会有一个压缩阶段，可以通过多进程得压缩。</p><ul><li>terser-webpack-plugin 开启 parallel 参数</li></ul><p><a target="_blank" rel="noopener noreferrer" href="https://www.npmjs.com/package/terser-webpack-plugin">terser-webpack-plugin<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> </span><span class="token maybe-class-name">TerserPlugin</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;terser-webpack-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">module</span><span class="token punctuation">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  optimization</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    minimize</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    minimizer</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">TerserPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        parallel</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">4</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h2 id="使用缓存来提升二次构建速度"><a aria-hidden="true" tabindex="-1" href="/javascript/webpack/base#使用缓存来提升二次构建速度"><span class="icon,icon-link"></span></a>使用缓存来提升二次构建速度</h2><p>缓存思路：</p><ul><li>babel-loader 开启缓存</li><li>terser-webpack-plugin 开启缓存</li><li>使用 cache-loader 或者 <strong>hard-source-webpack-plugin</strong></li></ul><h2 id="缩小构建目标"><a aria-hidden="true" tabindex="-1" href="/javascript/webpack/base#缩小构建目标"><span class="icon,icon-link"></span></a>缩小构建目标</h2><p>目的：尽可能少构建模块</p><p>比如 babel-loader 不解析 node_modules</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">rules</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    test</span><span class="token punctuation">:</span><span class="token regex">/\.js$/</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    loader</span><span class="token punctuation">:</span><span class="token string">&#x27;happypack/loader&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    exclude</span><span class="token punctuation">:</span><span class="token string">&#x27;node_modules&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>减少文件搜索范围(加快搜索时间)</p><ul><li>优化 resolve.modules 配置（减少模块的搜索层级）</li><li>优化 resolve.mainFields 配置</li><li>优化 resolve.extensions 配置</li><li>合理使用 alias</li></ul><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">module</span><span class="token punctuation">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    resolve</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      alias</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        react</span><span class="token punctuation">:</span><span class="token plain">path</span><span class="token punctuation">.</span><span class="token method function property-access">resolve</span><span class="token punctuation">(</span><span class="token plain">__dirname</span><span class="token punctuation">,</span><span class="token string">&#x27;./node_modules/react/dist/react.min.js&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      modules</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token plain">path</span><span class="token punctuation">.</span><span class="token method function property-access">resolve</span><span class="token punctuation">(</span><span class="token plain">__dirname</span><span class="token punctuation">,</span><span class="token string">&#x27;node_modules&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      extensions</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">&#x27;.js&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      mainFields</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">&#x27;main&#x27;</span><span class="token punctuation">]</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h2 id="使用-tree-shaking-擦除无用的-js-和-css"><a aria-hidden="true" tabindex="-1" href="/javascript/webpack/base#使用-tree-shaking-擦除无用的-js-和-css"><span class="icon,icon-link"></span></a>使用 Tree Shaking 擦除无用的 js 和 css</h2><ul><li>PurifyCSS：遍历代码，识别已经用到的 CSS class</li><li>uncss: HTML 需要通过 jsdom 加载，所有的样式通过 PostCSS 解析，通过 document.querySelector 来识别在 html 文件里面不存在的选择器。</li></ul></div><div class="__dumi-default-layout-footer-meta"><span data-updated-text="最后更新时间：">2/15/2021 13:29:03</span></div></div></div></div>
	<script>
  window.g_useSSR = true;
  window.g_initialProps = {};
	</script>

    <script src="/umi.js"></script>
  </body>
</html>
